# Toolbox 完整项目启动说明

## 🎉 恭喜！项目已经创建完成并成功运行！

项目位置：`C:\Users\sxh\toolbox-rebuild`

## 当前运行状态

✅ **后端服务**：已在 6791 端口运行
✅ **前端应用**：Electron 窗口已打开

## 项目概述

这是一个完全复制自原 Toolbox 应用的重建版本，包含：

### 后端 (NestJS)
- **技术栈**：NestJS 10.x + Socket.IO 4.6 + TypeScript
- **端口**：6791
- **API前缀**：/api
- **所有业务逻辑**：完整复制自原项目

### 前端 (Electron)
- **技术栈**：Electron 28.x + Socket.IO Client + Particles.js
- **界面**：完全模仿原始界面设计
- **功能**：6个主要工具模块

## 核心功能

### 1. 批量任务

#### 亚马逊批量测活 (amazon-check-live)
- 批量检测 Amazon 账号存活状态
- 支持 HubStudio 和 RoxyBrowser 平台
- 可配置并发数量和测活卡数
- 实时日志显示测活进度

**使用方法**：
1. 点击"亚马逊批量测活"卡片
2. 配置参数：
   - 平台客户端：HubStudio / RoxyBrowser
   - 并发数量：建议 4
   - 单次测活卡数：建议 6
   - 颜色等待时间：150000ms
3. 点击"开始测活"
4. 在日志面板查看进度

#### 亚马逊批量注册 (amazon-register)
- 批量注册 Amazon 新账号
- 自动请求代理、邮箱、手机资源
- 自动创建浏览器环境
- 绑定 OTP 密钥和账号凭证

**使用方法**：
1. 点击"亚马逊批量注册"卡片
2. 配置参数：
   - 平台客户端选择
   - 并发数量
   - 密码规则
   - 是否绑定地址
3. 点击"开始注册"
4. 监控任务进度

### 2. 其他工具

#### Cookie转换 (cookie-transformer)
- Cookie 格式转换工具
- 支持多种 Cookie 格式互转

#### Roxy转HubStudio (roxybrowser-to-hubstudio)
- RoxyBrowser 配置转换为 HubStudio 格式
- 一键迁移浏览器配置

#### 小火箭二维码生成 (qrcode-generation)
- Shadowrocket 配置二维码生成器
- 支持自定义二维码尺寸

#### 微软邮箱取软 (microsoft-email)
- Microsoft Graph API 邮件获取
- 支持收件箱和垃圾邮件查看
- 自动提取验证码

**使用方法**：
1. 点击"微软邮箱取软"卡片
2. 输入 Microsoft Graph API 凭证：
   - Client ID
   - Client Secret
   - Refresh Token
3. 选择邮件来源（收件箱/垃圾邮件）
4. 点击"获取邮件"
5. 查看邮件列表和验证码

## API 端点

### HTTP API (http://localhost:6791/api)

**地址服务**
- `POST /api/address/postal` - 根据邮编生成地址
- `GET /api/address/random` - 生成随机美国地址

**邮件服务**
- `POST /api/email/all` - 获取所有邮件
- `POST /api/email/latest` - 获取最新邮件
- `POST /api/email/inbox/latest` - 获取收件箱最新邮件
- `POST /api/email/inbox/all` - 获取收件箱所有邮件
- `POST /api/email/trash/all` - 获取垃圾邮件

### WebSocket 事件 (ws://localhost:6791)

**客户端发送**
- `task.start` - 启动任务
- `task.stop` - 停止任务
- `task.config` - 更新任务配置
- `response.card.info` - 返回卡片信息
- `response.email.info` - 返回邮件信息
- `response.phone.info` - 返回电话信息
- `response.proxy.info` - 返回代理信息

**服务器发送**
- `backend.task.runState` - 任务运行状态
- `run.task.log` - 任务日志
- `request.card.info` - 请求卡片信息
- `request.email.info` - 请求邮件信息
- `request.phone.info` - 请求电话信息
- `request.proxy.info` - 请求代理信息

## 启动方式

### 方式一：使用启动脚本（推荐）

#### Windows 批处理脚本
双击以下文件即可启动：

- `start-all.bat` - 同时启动前后端（最简单）
- `start-backend.bat` - 只启动后端
- `start-frontend.bat` - 只启动前端

#### 命令行启动
```bash
# 在项目根目录
npm start  # 同时启动前后端
```

### 方式二：分别启动

#### 启动后端
```bash
cd backend
npm start
```
后端将在 6791 端口启动

#### 启动前端
```bash
cd frontend
npm start
```
Electron 窗口将自动打开

### 方式三：开发模式

#### 后端开发模式（带热重载）
```bash
cd backend
npm run dev
```

#### 前端开发模式（带调试工具）
```bash
cd frontend
npm run dev
```

## 项目结构

```
toolbox-rebuild/
├── backend/              # NestJS 后端
│   ├── src/
│   │   ├── controllers/  # 控制器（地址、邮件）
│   │   ├── services/     # 服务（地址、邮件、任务调度）
│   │   ├── modules/      # NestJS 模块
│   │   ├── dto/          # 数据传输对象
│   │   ├── interfaces/   # TypeScript 接口
│   │   ├── utils/        # 工具函数
│   │   ├── workers/      # Worker 进程
│   │   └── main.ts       # 入口文件
│   ├── resources/        # 资源文件
│   │   ├── task.worker.js    # 任务 Worker (8.5MB)
│   │   ├── build/            # Sharp 图像处理库
│   │   ├── client-dist/      # Socket.IO 客户端
│   │   ├── vendor/           # libvips 依赖
│   │   └── appIcon.png       # 应用图标
│   ├── dist/             # 编译输出
│   ├── package.json
│   └── tsconfig.json
├── frontend/             # Electron 前端
│   ├── src/
│   │   ├── main.js       # Electron 主进程
│   │   ├── preload.js    # 预加载脚本
│   │   └── renderer/     # 渲染进程
│   │       ├── index.html
│   │       ├── css/      # 样式文件
│   │       │   ├── styles.css
│   │       │   └── particles.css
│   │       └── js/       # JavaScript 文件
│   │           ├── main.js
│   │           ├── tools.js
│   │           └── particles-config.js
│   └── package.json
├── README.md             # 项目说明
├── QUICKSTART.md         # 快速开始指南
├── PROJECT-SUMMARY.md    # 项目总结
├── 启动说明.md           # 本文件
├── install.bat           # 安装脚本
├── start-all.bat         # 启动所有服务
├── start-backend.bat     # 启动后端
└── start-frontend.bat    # 启动前端
```

## 资源文件说明

### 已复制的资源文件

所有资源文件已从原项目 `C:\Users\sxh\toolbox-project\resources\` 完整复制：

1. **task.worker.js** (8.5MB)
   - 任务执行的 Worker 进程
   - 包含所有业务逻辑

2. **build/** 
   - Sharp 图像处理库的原生绑定
   - libvips 相关 DLL 文件

3. **client-dist/**
   - Socket.IO 客户端库
   - 用于前端 WebSocket 连接

4. **vendor/**
   - libvips 8.14.5 依赖库
   - 图像处理所需的原生库

5. **appIcon.png**
   - 应用程序图标

## 业务逻辑说明

### 数据流

```
前端界面 (Electron)
    ↓ (Socket.IO)
后端服务 (NestJS)
    ↓
任务调度器 (TaskSchedulerService)
    ↓
Worker 进程 (task.worker.js)
    ↓
浏览器自动化 (HubStudio/RoxyBrowser)
```

### 核心服务

#### AddressService
- 生成美国地址信息
- 支持按邮编查询
- 使用 OpenStreetMap Nominatim API
- 包含所有美国州信息

#### EmailService
- Microsoft Graph API 集成
- OAuth2 认证刷新
- 邮件获取和过滤
- 验证码提取

#### TaskSchedulerService
- 任务生命周期管理
- Worker 进程调度
- 实时状态更新
- 日志收集和广播

### 配置参数

#### 测活任务配置
```javascript
{
  type: 'checklive',
  platformClient: 'hubstudio',  // 或 'roxybrowser'
  complicating: 4,              // 并发数量
  singleCount: 6,               // 单次测活卡数
  colorWaitTime: 150000,        // 颜色等待时间(ms)
  sort: 'top-bottom',           // 排列顺序
  arrange: true,                // 自动排列窗口
  status: 'running'             // 任务状态
}
```

#### 注册任务配置
```javascript
{
  type: 'register',
  platformClient: 'hubstudio',
  complicating: 4,              // 并发数量
  passwordRule: 'email-password', // 密码规则
  bindAddress: true,            // 是否绑定地址
  failedDeleteEnvironment: false, // 失败是否删除环境
  status: 'running'
}
```

## 调试和开发

### 查看后端日志
```bash
cd backend
npm start
# 日志将输出到控制台
```

### 查看前端日志
1. 打开 Electron 应用
2. 按 F12 打开开发者工具
3. 查看 Console 标签页

### API 测试

使用 curl 测试 API：

```bash
# 测试地址服务
curl http://localhost:6791/api/address/random

# 测试邮件服务
curl -X POST http://localhost:6791/api/email/inbox/latest \
  -H "Content-Type: application/json" \
  -d "{\"client_id\":\"xxx\",\"client_secret\":\"xxx\",\"refresh_token\":\"xxx\"}"
```

使用浏览器测试 WebSocket：

```javascript
const socket = io('http://localhost:6791');

socket.on('connect', () => {
  console.log('已连接');
  
  // 启动测活任务
  socket.emit('task.start', {
    type: 'checklive',
    platformClient: 'hubstudio',
    complicating: 4,
    status: 'running'
  });
});

socket.on('run.task.log', (log) => {
  console.log('日志:', log);
});
```

## 常见问题

### Q1: 后端启动失败，提示端口占用
**A**: 运行以下命令检查并结束占用进程：
```bash
netstat -ano | findstr :6791
taskkill /PID <进程ID> /F
```

### Q2: 前端无法连接后端
**A**: 确保：
1. 后端已启动并监听 6791 端口
2. 防火墙没有阻止连接
3. 查看浏览器控制台的错误信息

### Q3: 任务执行失败
**A**: 检查：
1. HubStudio/RoxyBrowser 是否已安装
2. 环境配置是否正确
3. 网络连接是否正常
4. 查看日志面板的详细错误

### Q4: 资源文件缺失
**A**: 确保 `backend/resources/` 目录包含：
- task.worker.js (约 8.5MB)
- build/ 文件夹
- client-dist/ 文件夹
- vendor/ 文件夹
- appIcon.png

如果缺失，从原项目复制：
```bash
Copy-Item "C:\Users\sxh\toolbox-project\resources\*" -Destination "backend\resources\" -Recurse -Force
```

## 性能优化建议

### 1. 内存使用
- 批量任务并发数不要超过 CPU 核心数
- 定期清理日志面板
- 关闭不使用的工具窗口

### 2. 网络优化
- 使用稳定的网络连接
- 避免高峰期进行批量操作
- 合理设置任务间隔时间

### 3. 系统资源
- 关闭其他占用资源的程序
- 确保有足够的磁盘空间
- 监控系统内存使用率

## 安全注意事项

⚠️ **重要提醒**：

1. **合法使用**：仅用于合法用途，遵守相关服务条款
2. **账号安全**：妥善保管 API 密钥和凭证
3. **速率限制**：注意 API 调用频率限制
4. **数据备份**：重要数据请及时备份
5. **网络安全**：不要在公共网络使用敏感功能

## 更新和维护

### 更新依赖
```bash
# 更新后端依赖
cd backend
npm update

# 更新前端依赖
cd frontend
npm update
```

### 清理和重建
```bash
# 清理后端
cd backend
rm -rf node_modules dist
npm install
npm run build

# 清理前端
cd frontend
rm -rf node_modules
npm install
```

## 技术支持

如遇到问题：

1. 查看本文档的常见问题部分
2. 查看日志面板的错误信息
3. 检查 README.md 获取更多技术细节
4. 提交 Issue 报告问题

## 项目文档

- `README.md` - 完整的项目说明和技术文档
- `QUICKSTART.md` - 快速开始指南
- `PROJECT-SUMMARY.md` - 项目功能总结
- `启动说明.md` - 本文件，详细的使用说明

## 开发信息

- **创建日期**: 2025-12-08
- **版本**: v1.0.0
- **基于**: 原 Toolbox 应用完整反编译和重构
- **技术栈**: NestJS + Electron + Socket.IO + TypeScript

---

**祝使用愉快！🚀**

如有任何问题或建议，欢迎反馈！
